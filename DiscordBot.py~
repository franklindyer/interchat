from ChatBot import *
import discord
from discord.ext import commands
import requests

class DiscordBot(ChatBot):
    def __init__(self, credfile):
        super().__init__("discord", credfile)
        self.token = open(credfile, 'r').read()
        self.intents = discord.Intents.default()
        self.bot = commands.Bot(command_prefix="$", intents=self.intents)
        self.register_commands()

    def set_service(self, service):
        self.service = service
        
    async def handle_msg(self, userid, msg):
        await self.service.handle_msg(userid, msg)

    async def send_msg(self, userid, msg):
        user = await self.bot.fetch_user(userid)
        
        
    def register_commands(self):
        @self.bot.command()
        async def hello(ctx):
            print(ctx.user)
            await ctx.send("Hi der")

        @self.bot.event
        async def on_message(message):
            await self.handle_msg(message.author.id, message.content)
        
        
    def connect(self):
        self.bot.run(self.token)
        print("Discord bot successfully connected")

        
